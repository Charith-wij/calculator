<form [formGroup]="propertyForm" (ngSubmit)="calculateFigures()">
    <div class="calculator-container row">
        <div class="col-8 left">
            <h2 class="mt-3"> Property : {{propertyAddress}}</h2>
            <!-- Purchase Information Card -->
            <mat-card class="input-card">
                <mat-card-header>
                    <h3>Purchase Information</h3>
                </mat-card-header>
                <mat-card-content>
                    <div formGroupName="purchaseInformation">
                        <div class="field-row">
                            <mat-form-field appearance="outline" class="custom-input">
                                <mat-label>Purchase Price</mat-label>
                                <input matInput formControlName="purchasePrice" type="number" required>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="custom-input">
                                <mat-label>Legal/Auction/Sourcing Fees</mat-label>
                                <input matInput formControlName="legalAndAuctionFees" type="number" required>
                            </mat-form-field>

                            <mat-form-field appearance="outline" class="custom-input">
                                <mat-label>Refurb Cost</mat-label>
                                <input matInput formControlName="refurbCost" type="number" required>
                            </mat-form-field>
                        </div>
                        <!-- <div class="row "> Calculated </div> -->
                        <div class="field-row">
                            <mat-form-field appearance="outline" class="custom-input">
                                <mat-label class="calculated-text-color">Stamp Duty (BTL Res rate)</mat-label>
                                <input class="calculated-text-color" matInput readonly="true"
                                    formControlName="stampDuty" type="number" tabindex="-1">
                            </mat-form-field>
                        </div>
                    </div>
                </mat-card-content>
            </mat-card>

            <!-- Borrowing Information Card -->
            <mat-card class="input-card">
                <mat-card-header>
                    <h3>Borrowing</h3>
                </mat-card-header>
                <mat-card-content>
                    <div formGroupName="borrowingInformation">
                        <div class="field-row">
                            <mat-form-field appearance="outline">
                                <mat-label>Deposit (%)</mat-label>
                                <input matInput formControlName="depositPercentage" type="number" required>
                            </mat-form-field>
                            <!-- <div class="spacing-field-one"></div> -->
                            <mat-form-field appearance="outline">
                                <mat-label>Months on Bridging</mat-label>
                                <input matInput formControlName="monthsOnBridging" type="number" required>
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label>Mortgage Arrangement Fee (%)</mat-label>
                                <input matInput formControlName="mortgageFeePercentage" type="number" required>
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label>Mortgage Interest Rate (%)</mat-label>
                                <input matInput formControlName="mortgageInterestRate" type="number" required>
                            </mat-form-field>
                        </div>
                        <!-- <div class="field-row"> Calculated </div> -->
                        <div class="field-row">
                            <mat-form-field appearance="outline">
                                <mat-label class="calculated-text-color">Mortgage (%)</mat-label>
                                <input class="calculated-text-color" matInput readonly="true"
                                    formControlName="mortgagePercentage" type="number" tabindex="-1">
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label class="calculated-text-color">Deposit Amount</mat-label>
                                <input class="calculated-text-color" matInput readonly="true"
                                    formControlName="dipositAmount" type="number" tabindex="-1">
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label class="calculated-text-color">Mortgage Amount</mat-label>
                                <input class="calculated-text-color" matInput readonly="true"
                                    formControlName="mortgageAmount" type="number" tabindex="-1">
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label class="calculated-text-color">Mortgage Fee Amount</mat-label>
                                <input class="calculated-text-color" matInput readonly="true"
                                    formControlName="mortgageFeeAmount" type="number" tabindex="-1">
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label class="calculated-text-color">Mortgage Interest Amount</mat-label>
                                <input class="calculated-text-color" matInput readonly="true"
                                    formControlName="mortgageInterestAmount" type="number" tabindex="-1">
                            </mat-form-field>
                        </div>
                    </div>
                </mat-card-content>
            </mat-card>

            <!-- BTL Information Card -->
            <mat-card class="input-card">
                <mat-card-header>
                    <h3>BTL Information (if applicable)</h3>
                </mat-card-header>
                <mat-card-content>
                    <div formGroupName="BTLInformation">
                        <div class="field-row">
                            <mat-form-field appearance="outline">
                                <mat-label>Monthly Rent</mat-label>
                                <input matInput formControlName="monthlyRent" type="number" required>
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label>Letting Agents Fee (%)</mat-label>
                                <input matInput formControlName="lettingAgentFee" type="number" required>
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label>Monthly Running Costs</mat-label>
                                <input matInput formControlName="monthlyRunningCosts" type="number" required>
                            </mat-form-field>
                        </div>
                        <!-- <div class="field-row">Clculated</div> -->
                        <div class="field-row">
                            <mat-form-field appearance="outline">
                                <mat-label class="calculated-text-color">Letting Agents Fee Amount</mat-label>
                                <input class="calculated-text-color" matInput readonly="true"
                                    formControlName="lettingAgentFeeAmount" type="number" tabindex="-1">
                            </mat-form-field>
                        </div>
                    </div>
                </mat-card-content>
            </mat-card>

            <!-- BRR Information Card -->
            <mat-card class="input-card">
                <mat-card-header>
                    <h3>BRR Information (if applicable)</h3>
                </mat-card-header>
                <mat-card-content>
                    <div formGroupName="BRRInformation">
                        <div class="field-row">
                            <mat-form-field appearance="outline">
                                <mat-label>New Market Value</mat-label>
                                <input matInput formControlName="newMarketValue" type="number" required>
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label>Refinanced at (% LTV)</mat-label>
                                <input matInput formControlName="refinancedLTV" type="number" required>
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label>Mortgage Arrangement Fee (%)</mat-label>
                                <input matInput formControlName="refinancingArrangementFee" type="number" required>
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label>Mortgage Interest Rate (%)</mat-label>
                                <input matInput formControlName="refinancingInterestRate" type="number" required>
                            </mat-form-field>
                        </div>
                        <!-- <div class="field-row"> Calculated</div> -->
                        <div class="field-row">
                            <mat-form-field appearance="outline">
                                <mat-label class="calculated-text-color">Refinanced LTV Amount</mat-label>
                                <input class="calculated-text-color" matInput readonly="true"
                                    formControlName="refinancedLTVAmount" type="number" tabindex="-1">
                            </mat-form-field>
                            <!-- <div class="spacing-field-half"></div> -->
                            <mat-form-field appearance="outline">
                                <mat-label class="calculated-text-color">Mortgage Fee Amount</mat-label>
                                <input class="calculated-text-color" matInput readonly="true"
                                    formControlName="refinanceFeeAmount" type="number" tabindex="-1">
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label class="calculated-text-color">Mortgage Interest Amount</mat-label>
                                <input class="calculated-text-color" matInput readonly="true"
                                    formControlName="refinanceInterestAmount" type="number" tabindex="-1">
                            </mat-form-field>
                        </div>
                    </div>
                </mat-card-content>
            </mat-card>

            <!-- BTS Information Card -->
            <mat-card class="input-card">
                <mat-card-header>
                    <h3>BTS Information (if applicable)</h3>
                </mat-card-header>
                <mat-card-content>
                    <div formGroupName="BTSInformation">
                        <div class="field-row">
                            <mat-form-field appearance="outline">
                                <mat-label>Sale Price</mat-label>
                                <!-- <span matPrefix>£</span> -->
                                <input matInput formControlName="salePrice" type="number" required>
                            </mat-form-field>
                            <mat-form-field appearance="outline">
                                <mat-label>Legal Fees</mat-label>
                                <input matInput formControlName="legalFeesBTS" type="number" required>
                            </mat-form-field>

                            <mat-form-field appearance="outline">
                                <mat-label>Estate Agent Fee (%)</mat-label>
                                <input matInput formControlName="estateAgentFee" type="number" required>
                            </mat-form-field>
                        </div>
                        <!-- <div class="field-row"> Calculated</div> -->
                        <div class="field-row">
                            <mat-form-field appearance="outline">
                                <mat-label class="calculated-text-color">Estate Agent Fee Amount</mat-label>
                                <input class="calculated-text-color" matInput readonly="true"
                                    formControlName="estateAgentFeeAmount" type="number" tabindex="-1">
                            </mat-form-field>
                        </div>
                    </div>
                </mat-card-content>
               
            </mat-card>
        </div>

        <!-- Calculation Results -->
        <div class="col-4 right">
            <mat-card class="input-card figures-card">
                <ng-container *ngIf="propertyForm.invalid">
                    <mat-card-content class="message-info">
                        <h2> Fill in the details to see the figures.. </h2>
                    </mat-card-content>
                </ng-container>
                <ng-container *ngIf="figures">
                    <ng-container *ngIf="propertyForm.valid">
                        <mat-card-content>
                            <h3 class="figure-title">Exit Option - BTL</h3>
                            <div class="grid-container">
                                <div>Total Investment Costs:</div>
                                <div class="text-end">{{ figures.exitOptionBTL.totalInvestmentCosts | currency: 'GBP'}}</div>
        
                                <div>Monthly Cashflow:</div>
                                <div class="text-end">{{ figures.exitOptionBTL.monthlyCashflow | currency: 'GBP'}}</div>
        
                                <div>Gross Yield: </div>
                                <div class="text-end">{{ figures.exitOptionBTL.grossYield}}%</div>
        
                                <div> Net Yield:</div>
                                <div class="text-end">{{ figures.exitOptionBTL.netYield }}%</div>
        
                                <div>Return On Investment:</div>
                                <div class="text-end">{{ figures.exitOptionBTL.returnOnInvestment }}%</div>
                            </div>
        
                            <h3 class="figure-title">Exit Option - BRR Refinance</h3>
                            <div class="grid-container">
                                <div>Refinanced Monthly Cashflow:</div>
                                <div class="text-end">{{ figures.exitOptionBRR.refinancedMonthlyCashflow | currency: 'GBP'}}</div>
        
                                <div>Cash Out From Refinancing:</div>
                                <div class="text-end">{{ figures.exitOptionBRR.cashOutFromRefinancing | currency: 'GBP'}}</div>
        
                                <div class="highlighted-cash-left-in">Money Left In Deal: </div>
                                <div class="highlighted-cash-left-in text-end">{{ figures.exitOptionBRR.moneyLeftInDeal | currency:
                                    'GBP'}}</div>
        
                                <div> Months Before No Money Left In:</div>
                                <div class="text-end">{{ figures.exitOptionBRR.monthsBeforeNoMoneyLeft }}</div>
        
                                <div>Return On Investment:</div>
                                <div class="text-end">{{ figures.exitOptionBRR.returnOnInvestment }}%</div>
                            </div>
        
                            <h3 class="figure-title">Exit Option - BTS</h3>
                            <div class="grid-container">
                                <div>Total Investment Costs:</div>
                                <div class="text-end">{{ figures.exitOptionBTS.totalInvestmentCosts | currency: 'GBP'}}</div>
        
                                <div>Total Selling Costs:</div>
                                <div class="text-end">{{ figures.exitOptionBTS.totalSellingCosts | currency: 'GBP'}}</div>
        
                                <div class="highlighted-profit">Profit From Deal: </div>
                                <div class="highlighted-profit text-end">{{ figures.exitOptionBTS.profitFromDeal | currency: 'GBP'}}
                                </div>
        
                                <div> Return On Investment:</div>
                                <div class="text-end">{{ figures.exitOptionBTS.returnOnInvestment }}%</div>
                            </div>
                        </mat-card-content>
                    </ng-container>
                </ng-container>
                <!-- <hr> -->
                <ng-container *ngIf="formData?.metaData as metaData">
                    <div class="mt-3 p-3 meta-data-grid">
                        <div>Guide Price</div>
                        <div class="text-end">
                            {{metaData.guidePrice}}
                        </div>
                        <div>Rightmove Link</div>
                        <div>
                            <a [href]="metaData.rightmoveLink" target="_blank">{{metaData.rightmoveLink}}</a>
                        </div>
                        <div>Auction Link</div>
                        <div>
                            <a [href]="metaData.auctionSiteLink" target="_blank">{{metaData.auctionSiteLink}}</a>
                        </div>
                        <div>Notes</div>
                        <div>
                            {{metaData.notes}}
                        </div>
                    </div>
                </ng-container>

                <div *ngIf="!propertyForm.invalid" class="d-grid button-wrapper">
                    <button class="btn btn-primary btn-block btn-lg" (click)="saveCalculation()">Save Calculation</button>
                </div>
            </mat-card>
        </div>
    </div>
</form>